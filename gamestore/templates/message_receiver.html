<script>
    window.addEventListener("message", receiveMessage, false);
    var gameFrame = $("#game-" + gameId);

    function receiveMessage(event) {
        var message = event.data;
        console.log("PostMessage received: ", message);
        switch (message.messageType) {
            case "SCORE":
                saveGamescore(event);
                break;
            case "SAVE":
                saveGamestate(event);
                break;
            case "LOAD_REQUEST":
                requestGamestate(event);
                break;
            case "LOAD":
                loadGamestate(event);
                break;
            case "ERROR":
                throwError(event);
                break;
            case "SETTING":
                setSettings(event);
                break;
            default:
                console.log("MessageType not recognized.");
        }
    }

    function saveGamescore(event) {
        var message = event.data;
        $.ajax({
            url: '{% url "save_gamescore" %}',
            type: 'POST',
            data: {
                "gameId": gameId,
                "score": message.score,
                "csrfmiddlewaretoken": getCookie('csrftoken')
            },
            success: function(result) {
                console.log("SUCCESS: ", result);
            },
            error: function(result) {
                console.log("ERROR: ", result);
            }
        })
    }

    function saveGamestate(event) {
        var message = event.data;
        $.ajax({
            url: '{% url "save_gamestate" %}',
            type: 'POST',
            data: {
                "gameId": gameId,
                "gameState": {
                    "score": message.gameState.score,
                    "playerItems": message.gameState.playerItems
                },
                "csrfmiddlewaretoken": getCookie('csrftoken')
            },
            success: function(result) {
                console.log("SUCCESS: ", result);
            },
            error: function(result) {
                console.log("ERROR: ", result);
            }
        })
    }


    function requestGamestate(event) {

    }


    function loadGamestate(event) {

    }


    function throwError(event) {

    }


    function setSettings(event) {
        var options = event.data.options;
        gameFrame.height(options.height).width(options.width);
    }
</script>